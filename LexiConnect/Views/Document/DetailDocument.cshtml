@model LexiConnect.Models.ViewModels.DetailDocumentViewModel
@{
    ViewData["Title"] = "Document Detail";
}

<link href="~/css/Document//DetailDocument.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />

<div class="page-wrapper">

    <!-- Sidebar trái -->
    <div class="sidebar">
        <h3>@Model.Document.Title</h3>
        <p>@Model.ViewerDisplayMessage</p>

        <div style="margin-top:20px;">
            <p><strong>Course:</strong> @Model.Document.Course?.CourseName</p>
            <p><strong>University:</strong> @Model.UploaderStats.UniversityName</p>
            <p><strong>Academic year:</strong> 2022/2023</p>
        </div>

        <div style="margin-top:20px;">
            <p><strong>Uploaded by:</strong></p>
            <a asp-controller="Profile"
               asp-action="PublicUserProfile"
               asp-route-id="@Model.UploaderStats.UploaderId"
               class="uploader-link">

                <div class="uploader">
                    <img src="@Model.UploaderStats.AvatarUrl" alt="avatar" />
                    <div>
                        <div class="uploader-name">@Model.UploaderStats.FullName</div>
                        <div class="uploader-university">@Model.UploaderStats.UniversityName</div>
                    </div>
                </div>

            </a>
            <!-- Thêm thống kê uploader -->
            <div class="uploader-stats">
                <div>
                    <i class="fa-solid fa-user-group"></i>
                    <span>@Model.UploaderStats.FollowerCount</span>
                </div>
                <div>
                    <i class="fa-solid fa-file-lines"></i>
                    <span>@Model.UploaderStats.UploadCount</span>
                </div>
                <div>
                    <i class="fa-solid fa-heart"></i>
                    <span>@Model.UploaderStats.LikeCount</span>
                </div>
            </div>
        </div>

        <div style="margin-top:20px; font-size:14px; color:#444;">
            <p><strong>Views:</strong> @Model.Document.ViewCount</p>
            @* <p><strong>Likes:</strong> @Model.Document.LikeCount</p> *@
            <p><strong>Can Download:</strong> @(Model.CanDownload ? "Yes" : "No")</p>
        </div>

        <button class="btn-download">Download</button>
    </div>

    <!-- Preview phải -->
    <div class="preview-wrapper">
        <h3>Document Preview</h3>

        <!-- Thanh action bar -->
        <div class="doc-action-bar">
            <button class="btn-download"
                    onclick="location.href='@Url.Action("Download", "Document", new { id = Model.Document.DocumentId })'">
                Download
            </button>
            <button class="btn-outline"><i class="fa fa-magic"></i> AI Tools</button>
            <button class="btn-outline"><i class="fa fa-thumbs-up" style="color:green;"></i>  <span>@Model.Document.LikeCount</span> </button>
            <button class="btn-outline"><i class="fa fa-thumbs-down" style="color:red;"></i> 0</button>
            <button class="btn-outline"><i class="fa fa-bookmark"></i> Save</button>

            <!-- Nút Favorite -->
            <button class="btn-outline btn-favorite @(Model.IsFavorited ? "active" : "")"
                    id="favoriteBtn"
                    data-document-id="@Model.Document.DocumentId">
                <i class="fa-heart @(Model.IsFavorited ? "fa-solid" : "fa-regular")" id="favoriteIcon"></i>
                <span id="favoriteText">@(Model.IsFavorited ? "Favorited" : "Favorite")</span>
            </button>

            <button class="btn-outline"><i class="fa fa-share"></i></button>
        </div>

        <!-- PDF Preview -->
        <div id="pdf-container" class="doc-preview"></div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    @if (TempData["Error"] != null)
    {
        <script>
            Swal.fire({
                icon: 'warning',
                title: 'Oops!',
                text: '@TempData["Error"]',
                confirmButtonText: 'OK'
            });
        </script>
    }
}



<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>

<script>
    // Truyền các URL từ server xuống JS
    window.pdfFileUrl = '@Url.Content(Model.FileUrl)';
    window.toggleFavoriteUrl = '@Url.Action("ToggleFavorite", "Document")';
</script>

<script src="~/js/Document/DetailDocument.js"></script>