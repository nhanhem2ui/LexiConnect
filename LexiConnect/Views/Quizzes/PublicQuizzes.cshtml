@model IEnumerable<BusinessObjects.Quiz>
@{
    ViewData["Title"] = "Explore Public Quizzes";
}

<link rel="stylesheet" href="~/css/Quizzes/PublicQuizzes.css" />

<div class="container mt-4 mb-5">
    <!-- Page Header -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-gradient mb-3">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="32" height="32" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path style="fill:#4EA4D9;" d="M285.586,167.246v-33.449h-51.938c-0.736-12.696-2.292-25.045-4.63-36.792 c13.39-4.207,25.536-9.527,35.9-15.844l4.665-2.843c-2.859-2.348-5.683-4.734-8.418-7.221 c-11.203-10.186-19.411-23.535-30.592-33.662c-1.3-0.821-2.637-1.574-3.998-2.283c-6.08-2.093-12.343-3.718-18.424-5.798 c-2.929-1.001-5.848-2.03-8.765-3.066C185.855,9.18,169.472,0,151.789,0c-9.746,0-19.097,2.792-27.795,8.157 c-1.228,0.058-2.454,0.111-3.683,0.211c-4.881,0.929-9.676,2.19-14.363,3.836c-4.207,2.086-8.217,4.49-12.071,7.176 c-10.666,9.003-19.789,19.585-29.244,29.831C55.019,59.63,44.668,69.547,33.075,77.756l5.584,3.404 c10.364,6.317,22.51,11.638,35.9,15.844c-2.338,11.746-3.895,24.096-4.63,36.792H17.992v33.449h51.921 c0.718,12.606,2.25,24.868,4.548,36.544c-13.424,4.225-25.596,9.571-35.975,15.92l-9.774,5.98c0.543,0.78,1.09,1.56,1.648,2.331 c6.974,8.46,14.69,16.224,23.111,23.245c18.813,13.763,38.788,26.423,60.055,35.999c1.416,0.552,2.842,1.068,4.277,1.558 c10.388,8.196,21.884,12.493,33.986,12.493c17.057,0,32.903-8.543,46.149-24.502c1.842-0.594,3.681-1.215,5.511-1.898 c11.571-5.304,22.621-11.695,32.948-19.137c7.956-6.711,14.855-14.356,21.362-22.478c3.083-4.117,6.086-8.312,8.951-12.6 l-1.619-0.99c-10.378-6.349-22.549-11.695-35.975-15.92c2.298-11.676,3.829-23.939,4.548-36.544L285.586,167.246L285.586,167.246z M200.15,133.797h-31.636v-26.136c9.545-0.553,18.897-1.578,27.941-3.043C198.252,113.914,199.494,123.695,200.15,133.797z M168.513,41.885c5.205,5.109,10.24,12.383,14.672,21.428c1.391,2.839,2.704,5.8,3.939,8.87c-6.068,0.877-12.291,1.529-18.611,1.95 V41.885z M135.064,41.885v32.246c-6.32-0.421-12.543-1.073-18.611-1.95c1.235-3.07,2.548-6.031,3.939-8.87 C124.825,54.268,129.861,46.994,135.064,41.885z M228.269,61.867c-2.645,1.01-5.379,1.967-8.189,2.868 c-1.65-4.496-3.452-8.809-5.372-12.96C219.442,54.799,223.982,58.156,228.269,61.867z M75.309,61.867 c4.287-3.711,8.827-7.068,13.561-10.093c-1.92,4.151-3.722,8.465-5.372,12.96C80.688,63.833,77.954,62.878,75.309,61.867z M107.123,104.618c9.045,1.465,18.396,2.49,27.941,3.043v26.136h-31.635C104.085,123.695,105.327,113.914,107.123,104.618z M103.412,167.246h31.652v25.857c-9.581,0.554-18.966,1.584-28.042,3.058C105.265,186.942,104.051,177.251,103.412,167.246z M135.064,259.43c-5.205-5.109-10.24-12.383-14.672-21.428c-1.47-2.998-2.849-6.137-4.143-9.391 c6.131-0.892,12.424-1.553,18.815-1.978V259.43z M168.513,259.43v-32.797c6.391,0.425,12.684,1.086,18.815,1.978 c-1.294,3.255-2.674,6.394-4.143,9.391C178.753,247.047,173.718,254.321,168.513,259.43z M83.318,236.087 c1.649,4.532,3.45,8.885,5.372,13.07c-4.752-3.048-9.308-6.432-13.607-10.173C77.742,237.962,80.491,236.997,83.318,236.087z M228.496,238.984c-4.299,3.741-8.855,7.125-13.607,10.174c1.922-4.186,3.723-8.537,5.372-13.07 C223.088,236.997,225.837,237.962,228.496,238.984z M196.555,196.162c-9.076-1.474-18.461-2.504-28.042-3.058v-25.857h31.652 C199.528,177.251,198.312,186.942,196.555,196.162z"></path> <path style="fill:#9CD8FF;" d="M123.995,8.157c-1.228,0.058-2.454,0.111-3.683,0.211c-4.881,0.929-9.676,2.19-14.363,3.836 c-4.207,2.086-8.217,4.49-12.071,7.176C83.212,28.383,74.09,38.964,64.635,49.211C55.02,59.63,44.669,69.547,33.076,77.756 l5.584,3.404c10.364,6.317,22.51,11.638,35.9,15.844c-2.338,11.746-3.895,24.096-4.63,36.792H17.992v33.449h51.921 c0.718,12.606,2.25,24.868,4.548,36.544c-13.424,4.225-25.596,9.571-35.975,15.92l-9.774,5.98c0.543,0.78,1.09,1.56,1.648,2.331 c6.974,8.46,14.69,16.224,23.111,23.245c18.813,13.763,38.788,26.423,60.055,35.999c1.416,0.552,2.842,1.068,4.277,1.558 c10.388,8.196,21.884,12.493,33.986,12.493V0C142.043,0,132.692,2.792,123.995,8.157z M75.083,238.984 c2.659-1.021,5.408-1.987,8.235-2.897c1.649,4.532,3.45,8.885,5.372,13.07C83.938,246.109,79.382,242.725,75.083,238.984z M83.499,64.734c-2.811-0.901-5.545-1.858-8.189-2.868c4.287-3.711,8.827-7.068,13.561-10.093 C86.951,55.925,85.149,60.239,83.499,64.734z M135.064,259.43c-5.205-5.109-10.24-12.383-14.672-21.428 c-1.47-2.998-2.849-6.137-4.143-9.391c6.131-0.892,12.424-1.553,18.815-1.978V259.43z M135.064,193.104 c-9.581,0.554-18.966,1.584-28.042,3.058c-1.757-9.22-2.973-18.911-3.61-28.916h31.652V193.104z M135.064,133.797h-31.635 c0.656-10.102,1.898-19.883,3.694-29.179c9.045,1.465,18.396,2.49,27.941,3.043V133.797z M135.064,74.132 c-6.32-0.421-12.543-1.073-18.611-1.95c1.235-3.07,2.548-6.031,3.939-8.87c4.433-9.045,9.467-16.319,14.672-21.428V74.132z"></path> <path style="fill:#0274BA;" d="M151.789,301.043c-82.998,0-150.522-67.524-150.522-150.522S68.791,0,151.789,0 S302.31,67.524,302.31,150.522S234.788,301.043,151.789,301.043z M151.789,33.449c-64.554,0-117.072,52.519-117.072,117.072 s52.519,117.072,117.072,117.072s117.072-52.519,117.072-117.072S216.343,33.449,151.789,33.449z"></path> <path style="fill:#2698DE;" d="M34.716,150.522c0-64.554,52.519-117.072,117.072-117.072V0C68.791,0,1.267,67.524,1.267,150.522 s67.524,150.522,150.522,150.522v-33.449C87.235,267.594,34.716,215.075,34.716,150.522z"></path> <path style="fill:#3E3E42;" d="M498.174,438.8c16.746,16.746,16.746,43.895,0,60.641c-16.746,16.746-43.895,16.746-60.641,0 L308.317,370.224l60.641-60.641L498.174,438.8z"></path> <path style="fill:#797882;" d="M338.894,339.647l-30.577,30.577l129.217,129.217c16.746,16.746,43.895,16.746,60.641,0 c0.086-0.086,0.165-0.176,0.25-0.263L338.894,339.647z"></path> <path style="fill:#73B9E6;" d="M275.379,390.755c-30.48,0-59.135-11.87-80.689-33.423c-44.491-44.492-44.491-116.885,0-161.376 c21.552-21.552,50.208-33.423,80.689-33.423c30.48,0,59.136,11.87,80.687,33.423c44.491,44.491,44.491,116.884,0,161.376 C334.514,378.886,305.858,390.755,275.379,390.755z"></path> <path style="fill:#9CD8FF;" d="M194.951,195.704c-0.086,0.086-0.174,0.168-0.26,0.254c-44.491,44.491-44.491,116.884,0,161.376 c21.552,21.552,50.208,33.423,80.689,33.421c30.48,0,59.135-11.87,80.687-33.423c0.086-0.086,0.168-0.174,0.254-0.26 L194.951,195.704z"></path> <rect x="385.238" y="409.033" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -178.2172 428.4838)" style="fill:#C27526;" width="85.759" height="40.673"></rect> <rect x="391.463" y="424.073" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -193.2554 422.259)" style="fill:#F7DC4D;" width="43.243" height="40.673"></rect> <path style="fill:#003C61;" d="M275.379,390.755c-30.48,0-59.135-11.87-80.689-33.423c-44.491-44.492-44.491-116.885,0-161.376 c21.552-21.552,50.208-33.423,80.689-33.423c30.48,0,59.136,11.87,80.687,33.423c44.491,44.491,44.491,116.884,0,161.376 C334.514,378.886,305.858,390.755,275.379,390.755z M275.379,200.868c-20.241,0-39.271,7.883-53.582,22.195 c-29.546,29.546-29.546,77.62,0,107.166c14.313,14.313,33.342,22.195,53.582,22.195c20.24,0,39.269-7.882,53.582-22.195 c29.546-29.546,29.546-77.62,0-107.166C314.649,208.75,295.62,200.868,275.379,200.868z"></path> <path style="fill:#007BC7;" d="M275.379,352.424c-20.241,0-39.271-7.882-53.582-22.195c-29.546-29.546-29.546-77.62,0-107.166 l-27.105-27.105c-44.491,44.491-44.491,116.884,0,161.376c21.552,21.552,50.208,33.423,80.689,33.421 c30.48,0,59.135-11.87,80.687-33.423l-27.105-27.105C314.649,344.541,295.62,352.424,275.379,352.424z"></path> </g></svg>
            Explore Public Quizzes
            </h1>
        <p class="lead text-muted mb-4">Discover and take quizzes created by the community</p>

        <!-- Filter Pills -->
        <div class="filter-pills mb-4">
            <button class="filter-pill active" data-filter="all">
                <i class="bi bi-grid-fill"></i> All Quizzes
            </button>
            <button class="filter-pill" data-filter="Easy">
                <i class="bi bi-star"></i> Easy
            </button>
            <button class="filter-pill" data-filter="Medium">
                <i class="bi bi-star-fill"></i> Medium
            </button>
            <button class="filter-pill" data-filter="Hard">
                <i class="bi bi-fire"></i> Hard
            </button>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <i class="bi bi-search search-icon"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="Search quizzes by title or subject...">
            </div>
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        <!-- Stats Overview -->
        <div class="stats-row mb-5">
            <div class="stat-item">
                <div class="stat-value">@Model.Count()</div>
                <div class="stat-label">Total Quizzes</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">@Model.Select(q => q.Subject).Distinct().Count()</div>
                <div class="stat-label">Subjects</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">@Model.Count(q => q.CreatedAt >= DateTime.UtcNow.AddDays(-7))</div>
                <div class="stat-label">New This Week</div>
            </div>
        </div>

        <!-- Quizzes Grid -->
        <div class="row g-4" id="quizzesGrid">
            @foreach (var quiz in Model)
            {
                <div class="col-md-6 col-lg-4 quiz-item" data-difficulty="@quiz.Difficulty" data-title="@quiz.Title.ToLower()" data-subject="@quiz.Subject?.ToLower()">
                    <div class="public-quiz-card">
                        <!-- Card Header with Gradient -->
                        <div class="card-gradient-header @GetGradientClass(quiz.Difficulty)">
                            <div class="difficulty-badge">
                                @if (quiz.Difficulty == "Easy")
                                {
                                    <i class="bi bi-star"></i>
                                    <span>Easy</span>
                                }
                                else if (quiz.Difficulty == "Medium")
                                {
                                    <i class="bi bi-star-fill"></i>
                                    <span>Medium</span>
                                }
                                else
                                {
                                    <i class="bi bi-fire"></i>
                                    <span>Hard</span>
                                }
                            </div>
                        </div>

                        <!-- Card Content -->
                        <div class="card-content">
                            <div class="subject-tag">
                                <i class="bi bi-bookmark-fill"></i>
                                @quiz.Subject
                            </div>

                            <h5 class="card-title">@quiz.Title</h5>

                            <p class="card-description">
                                @(string.IsNullOrEmpty(quiz.Description) ? "Test your knowledge with this challenging quiz!" : quiz.Description)
                            </p>

                            <div class="card-meta">
                                <div class="meta-group">
                                    <i class="bi bi-person-circle"></i>
                                    <span>@(quiz.Creator?.FullName ?? "Anonymous")</span>
                                </div>
                                <div class="meta-group">
                                    <i class="bi bi-calendar3"></i>
                                    <span>@quiz.CreatedAt.ToLocalTime().ToString("MMM dd")</span>
                                </div>
                            </div>

                            <a href="@Url.Action("TakeQuiz", "Quizzes", new { id = quiz.QuizId })"
                               class="btn-take-quiz">
                                <i class="bi bi-play-circle-fill"></i>
                                <span>Take Quiz</span>
                                <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- No Results Message (Hidden by default) -->
        <div id="noResults" class="no-results" style="display: none;">
            <div class="empty-state-icon">
                <i class="bi bi-search"></i>
            </div>
            <h4>No quizzes found</h4>
            <p class="text-muted">Try adjusting your filters or search terms</p>
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="bi bi-globe"></i>
            </div>
            <h4 class="empty-state-title">No Public Quizzes Yet</h4>
            <p class="empty-state-text">Be the first to create a public quiz and share it with the community!</p>
            <a href="/AIAssistant/Question" class="btn btn-gradient btn-lg mt-3">
                <i class="bi bi-sparkles"></i> Create Public Quiz
            </a>
        </div>
    }
</div>

@functions {
    string GetGradientClass(string difficulty)
    {
        return difficulty switch
        {
            "Easy" => "gradient-easy",
            "Medium" => "gradient-medium",
            "Hard" => "gradient-hard",
            _ => "gradient-medium"
        };
    }
}

<script>
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-pill');
    const quizItems = document.querySelectorAll('.quiz-item');
    const searchInput = document.getElementById('searchInput');
    const noResults = document.getElementById('noResults');
    const quizzesGrid = document.getElementById('quizzesGrid');

    let activeFilter = 'all';

    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            activeFilter = button.dataset.filter;
            applyFilters();
        });
    });

    searchInput.addEventListener('input', () => {
        applyFilters();
    });

    function applyFilters() {
        const searchTerm = searchInput.value.toLowerCase();
        let visibleCount = 0;

        quizItems.forEach(item => {
            const difficulty = item.dataset.difficulty;
            const title = item.dataset.title;
            const subject = item.dataset.subject;

            const matchesFilter = activeFilter === 'all' || difficulty === activeFilter;
            const matchesSearch = searchTerm === '' ||
                                  title.includes(searchTerm) ||
                                  (subject && subject.includes(searchTerm));

            if (matchesFilter && matchesSearch) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });

        // Show/hide no results message
        if (visibleCount === 0) {
            quizzesGrid.style.display = 'none';
            noResults.style.display = 'flex';
        } else {
            quizzesGrid.style.display = 'flex';
            noResults.style.display = 'none';
        }
    }
</script>
